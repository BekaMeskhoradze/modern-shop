<div id="filters-overlay"
     class="fixed inset-0 z-[60]"
     role="dialog"
     aria-modal="true"
     aria-labelledby="filters-title">
    <!-- backdrop (click outside -> close) -->
    <div class="absolute inset-0 bg-black/30"
         onclick="closeFilters()"
         aria-hidden="true"></div>
    <aside id="filters-sheet"
           class="absolute right-0 top-0 h-full w-full max-w-md surface shadow-2xl transform transition-transform duration-200 translate-x-0">
        <!-- header -->
        <div class="p-4 border-b flex items-center justify-between"
             style="border-color: var(--line)">
            <h2 id="filters-title" class="text-lg font-semibold">Filters</h2>
            <button type="button"
                    class="px-2 py-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
                    onclick="closeFilters()"
                    aria-label="Close">✕</button>
        </div>
        <!-- body -->
        <div class="p-4 overflow-y-auto h-[calc(100%-56px)]">
            <form method="get" action="{{ request.path }}" class="space-y-4">
                {# შევინარჩუნოთ არჩეული category (თუ იყო) #}
                {% if filter_params.category %}<input type="hidden" name="category" value="{{ filter_params.category }}">{% endif %}
                <div>
                    <label class="block text-sm mb-1">Search in names</label>
                    <input type="text"
                           name="name"
                           value="{{ filter_params.name }}"
                           class="w-full px-3 py-2 rounded-xl border card"
                           placeholder="e.g. jacket"
                           autofocus>
                </div>
                <div>
                    <label class="block text-sm mb-1">Color</label>
                    <input type="text"
                           name="color"
                           value="{{ filter_params.color }}"
                           class="w-full px-3 py-2 rounded-xl border card"
                           placeholder="e.g. Black">
                </div>
                <div>
                    <label class="block text-sm mb-1">Size</label>
                    <select name="size" class="w-full px-3 py-2 rounded-xl border card">
                        <option value="">Any</option>
                        {% for s in sizes %}
                            <option value="{{ s.name }}"
                                    {% if filter_params.size == s.name %}selected{% endif %}>{{ s.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm mb-1">Min price</label>
                        <input type="number"
                               step="0.01"
                               name="min_price"
                               value="{{ filter_params.min_price }}"
                               class="w-full px-3 py-2 rounded-xl border card">
                    </div>
                    <div>
                        <label class="block text-sm mb-1">Max price</label>
                        <input type="number"
                               step="0.01"
                               name="max_price"
                               value="{{ filter_params.max_price }}"
                               class="w-full px-3 py-2 rounded-xl border card">
                    </div>
                </div>
                <div>
                    <label class="block text-sm mb-1">Sort by</label>
                    <select name="sort" class="w-full px-3 py-2 rounded-xl border card">
                        <option value="">Relevance</option>
                        <option value="newest"
                                {% if request.GET.sort == "newest" %}selected{% endif %}>Newest</option>
                        <option value="price_asc"
                                {% if request.GET.sort == "price_asc" %}selected{% endif %}>Price ↑</option>
                        <option value="price_desc"
                                {% if request.GET.sort == "price_desc" %}selected{% endif %}>Price ↓</option>
                    </select>
                </div>
                <div class="pt-2 flex items-center gap-2">
                    <button type="submit" class="px-4 py-2 rounded-xl brand-btn">Apply</button>
                    <a href="{{ request.path }}"
                       class="px-4 py-2 rounded-xl border card"
                       onclick="closeFilters()">Clear</a>
                    <button type="button"
                            class="ml-auto px-3 py-2 rounded-xl border card"
                            onclick="closeFilters()">Close</button>
                </div>
            </form>
        </div>
    </aside>
</div>
<script>
    // დახურვა (ანიმაციით + scroll unlock + modal cleanup)
    (function () {
      window.closeFilters = function () {
        const o = document.getElementById('filters-overlay');
        const s = document.getElementById('filters-sheet');
        if (!o || !s) return;
        s.classList.add('translate-x-full');
        document.documentElement.classList.remove('overflow-hidden');
        setTimeout(() => {
          const m = document.getElementById('modal');
          if (m) m.innerHTML = ''; // ამოღება DOM-იდან
        }, 180);
      };
      // ESC-ით დახურვა
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeFilters(); });
      // scroll lock ჩართვა, რადგან overlay უკვე ჩაისვა გახსნილ მდგომარეობაში
      document.documentElement.classList.add('overflow-hidden');
    })();
</script>
